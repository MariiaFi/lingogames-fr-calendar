<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Французский календарь - Изучение дней, месяцев и времён года</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6C63FF;
            --primary-light: #8A84FF;
            --secondary: #FF6584;
            --success: #4CAF50;
            --warning: #FF9800;
            --light: #F8F9FA;
            --dark: #343A40;
            --gray: #6C757D;
            --pastel-blue: #A7C5EB;
            --pastel-green: #A8E6CF;
            --pastel-yellow: #FFEAA7;
            --pastel-pink: #FFD3D3;
            --border-radius: 16px;
            --shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
        }

        h1 {
            color: var(--primary);
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .game-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
            transition: var(--transition);
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .menu-item {
            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-green));
            border-radius: var(--border-radius);
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            border: 3px solid transparent;
        }

        .menu-item:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .menu-item i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .menu-item h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .menu-item p {
            color: var(--gray);
            font-size: 1rem;
        }

        .section-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 2rem;
        }

        .game-area {
            display: none;
        }

        .active {
            display: block;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question-text {
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            color: var(--dark);
            line-height: 1.4;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .option {
            background: var(--light);
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 18px;
            text-align: center;
            cursor: pointer;
            font-size: 1.3rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }

        .option:hover {
            background: #f0f0f0;
            border-color: var(--primary-light);
        }

        .option.correct {
            background-color: #d4edda;
            border-color: var(--success);
            color: #155724;
        }

        .option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .drag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .drag-source, .drag-target {
            min-height: 100px;
            min-width: 150px;
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.3rem;
        }

        .drag-source {
            background: linear-gradient(135deg, var(--pastel-yellow), #FFD3A5);
            cursor: move;
            user-select: none;
        }

        .drag-target {
            background: linear-gradient(135deg, var(--pastel-pink), #E6A8D7);
            border: 2px dashed var(--primary);
        }

        .drag-target.over {
            background: linear-gradient(135deg, #c8e6c9, #a5d6a7);
            border-style: solid;
        }

        .drag-match {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .ordering-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .ordering-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            user-select: none;
            font-size: 1.4rem;
            border: 2px solid transparent;
        }

        .ordering-item:hover {
            border-color: var(--primary-light);
        }

        .ordering-item i {
            color: var(--gray);
        }

        .visual-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .visual-option {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid #e0e0e0;
        }

        .visual-option:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .visual-option i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            background: var(--primary-light);
            transform: translateY(-3px);
        }

        .btn-secondary {
            background: var(--gray);
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #3d8b40;
        }

        .progress-container {
            flex-grow: 1;
            max-width: 400px;
        }

        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 1.1rem;
            color: var(--gray);
        }

        .feedback {
            text-align: center;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            font-size: 1.3rem;
            display: none;
        }

        .feedback.correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .feedback.incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .hint {
            font-size: 1.1rem;
            color: var(--warning);
            margin-top: 10px;
            font-style: italic;
        }

        .score-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            color: var(--dark);
        }

        .stars {
            color: #FFD700;
            font-size: 1.5rem;
        }

        .pronunciation {
            font-size: 1rem;
            color: var(--gray);
            font-style: italic;
            margin-top: 5px;
        }

        .results-screen {
            text-align: center;
            display: none;
        }

        .results-screen.active {
            display: block;
        }

        .final-score {
            font-size: 4rem;
            color: var(--primary);
            margin: 30px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .encouragement {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .results-details {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            text-align: left;
            display: inline-block;
        }

        .results-details h3 {
            margin-bottom: 15px;
            color: var(--primary);
            text-align: center;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        footer {
            margin-top: 40px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
            width: 100%;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        /* Мобильная адаптация */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .game-card {
                padding: 20px;
            }
            
            .menu-item {
                min-height: 150px;
                padding: 20px 15px;
            }
            
            .menu-item h2 {
                font-size: 1.5rem;
            }
            
            .question-text {
                font-size: 1.5rem;
            }
            
            .option {
                font-size: 1.1rem;
                padding: 15px;
                min-height: 70px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .progress-container {
                width: 100%;
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .drag-container {
                flex-direction: column;
                align-items: center;
            }
            
            .visual-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Французский календарь</h1>
            <div class="subtitle">Изучайте дни недели, месяцы и времена года весело и легко!</div>
        </header>

        <main>
            <!-- Главное меню -->
            <div class="game-card main-menu" id="main-menu">
                <div class="menu-item" data-section="days">
                    <i class="fas fa-calendar-day"></i>
                    <h2>Дни недели</h2>
                    <p>Изучите дни недели на французском</p>
                </div>
                <div class="menu-item" data-section="months">
                    <i class="fas fa-calendar-alt"></i>
                    <h2>Месяцы</h2>
                    <p>Запомните все месяцы на французском</p>
                </div>
                <div class="menu-item" data-section="seasons">
                    <i class="fas fa-sun"></i>
                    <h2>Времена года</h2>
                    <p>Изучите времена года и связанные месяцы</p>
                </div>
            </div>

            <!-- Игровые области (скрыты по умолчанию) -->
            <div class="game-card game-area" id="days-game">
                <h2 class="section-title">Дни недели</h2>
                <div class="question-container" id="days-question-container">
                    <!-- Вопросы будут загружены с помощью JavaScript -->
                </div>
                <div class="feedback" id="days-feedback"></div>
                <div class="controls">
                    <button class="btn btn-secondary" id="days-back-btn">
                        <i class="fas fa-arrow-left"></i> Назад в меню
                    </button>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="days-progress"></div>
                        </div>
                        <div class="progress-text" id="days-progress-text">Вопрос 0 из 0</div>
                    </div>
                    <button class="btn" id="days-next-btn">
                        Далее <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div class="game-card game-area" id="months-game">
                <h2 class="section-title">Месяцы</h2>
                <div class="question-container" id="months-question-container">
                    <!-- Вопросы будут загружены с помощью JavaScript -->
                </div>
                <div class="feedback" id="months-feedback"></div>
                <div class="controls">
                    <button class="btn btn-secondary" id="months-back-btn">
                        <i class="fas fa-arrow-left"></i> Назад в меню
                    </button>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="months-progress"></div>
                        </div>
                        <div class="progress-text" id="months-progress-text">Вопрос 0 из 0</div>
                    </div>
                    <button class="btn" id="months-next-btn">
                        Далее <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <div class="game-card game-area" id="seasons-game">
                <h2 class="section-title">Времена года</h2>
                <div class="question-container" id="seasons-question-container">
                    <!-- Вопросы будут загружены с помощью JavaScript -->
                </div>
                <div class="feedback" id="seasons-feedback"></div>
                <div class="controls">
                    <button class="btn btn-secondary" id="seasons-back-btn">
                        <i class="fas fa-arrow-left"></i> Назад в меню
                    </button>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="seasons-progress"></div>
                        </div>
                        <div class="progress-text" id="seasons-progress-text">Вопрос 0 из 0</div>
                    </div>
                    <button class="btn" id="seasons-next-btn">
                        Далее <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Экран результатов -->
            <div class="game-card results-screen" id="results-screen">
                <h2 class="section-title">Результаты игры</h2>
                <div class="final-score" id="final-score">0%</div>
                <div class="encouragement" id="encouragement">Отличная работа!</div>
                
                <div class="results-details">
                    <h3>Детализация</h3>
                    <div class="result-item">
                        <span>Правильные ответы:</span>
                        <span id="correct-answers">0</span>
                    </div>
                    <div class="result-item">
                        <span>Всего вопросов:</span>
                        <span id="total-questions">0</span>
                    </div>
                    <div class="result-item">
                        <span>Процент успеха:</span>
                        <span id="success-percent">0%</span>
                    </div>
                    <div class="result-item">
                        <span>Звёзды:</span>
                        <span class="stars" id="stars">★★★☆☆</span>
                    </div>
                </div>
                
                <button class="btn btn-success" id="restart-btn">
                    <i class="fas fa-redo"></i> Начать заново
                </button>
            </div>
        </main>
    </div>

    <footer>
        <p>Игра создана для изучения французского языка. Все материалы проверены на корректность.</p>
        <p>© Французский календарь 2023</p>
    </footer>

    <script>
        // Данные для игры
        const gameData = {
            days: [
                { french: "lundi", russian: "понедельник", pronunciation: "(люнди)", order: 1 },
                { french: "mardi", russian: "вторник", pronunciation: "(марди)", order: 2 },
                { french: "mercredi", russian: "среда", pronunciation: "(меркреди)", order: 3 },
                { french: "jeudi", russian: "четверг", pronunciation: "(жёди)", order: 4 },
                { french: "vendredi", russian: "пятница", pronunciation: "(вандреди)", order: 5 },
                { french: "samedi", russian: "суббота", pronunciation: "(самди)", order: 6 },
                { french: "dimanche", russian: "воскресенье", pronunciation: "(диманш)", order: 7 }
            ],
            months: [
                { french: "janvier", russian: "январь", pronunciation: "(жанвье)", season: "hiver", order: 1 },
                { french: "février", russian: "февраль", pronunciation: "(феврье)", season: "hiver", order: 2 },
                { french: "mars", russian: "март", pronunciation: "(марс)", season: "printemps", order: 3 },
                { french: "avril", russian: "апрель", pronunciation: "(авриль)", season: "printemps", order: 4 },
                { french: "mai", russian: "май", pronunciation: "(май)", season: "printemps", order: 5 },
                { french: "juin", russian: "июнь", pronunciation: "(жюэн)", season: "été", order: 6 },
                { french: "juillet", russian: "июль", pronunciation: "(жюйе)", season: "été", order: 7 },
                { french: "août", russian: "август", pronunciation: "(ут)", season: "été", order: 8 },
                { french: "septembre", russian: "сентябрь", pronunciation: "(сетамбр)", season: "automne", order: 9 },
                { french: "octobre", russian: "октябрь", pronunciation: "(октобр)", season: "automne", order: 10 },
                { french: "novembre", russian: "ноябрь", pronunciation: "(новамбр)", season: "automne", order: 11 },
                { french: "décembre", russian: "декабрь", pronunciation: "(десамбр)", season: "hiver", order: 12 }
            ],
            seasons: [
                { french: "printemps", russian: "весна", pronunciation: "(прэнтан)", icon: "fas fa-seedling", months: [3, 4, 5] },
                { french: "été", russian: "лето", pronunciation: "(этэ)", icon: "fas fa-sun", months: [6, 7, 8] },
                { french: "automne", russian: "осень", pronunciation: "(отон)", icon: "fas fa-leaf", months: [9, 10, 11] },
                { french: "hiver", russian: "зима", pronunciation: "(ивэр)", icon: "fas fa-snowflake", months: [12, 1, 2] }
            ]
        };

        // Типы вопросов для каждого раздела
        const questionTypes = {
            days: [
                { type: "multiple-choice", text: "Выберите правильный перевод для: ", questionProp: "russian", answerProp: "french", optionsCount: 4 },
                { type: "multiple-choice-reverse", text: "Что значит: ", questionProp: "french", answerProp: "russian", optionsCount: 4 },
                { type: "ordering", text: "Расположите дни недели в правильном порядке:" },
                { type: "drag-match", text: "Сопоставьте французские дни недели с русскими переводами:" }
            ],
            months: [
                { type: "multiple-choice", text: "Выберите правильный перевод для: ", questionProp: "russian", answerProp: "french", optionsCount: 4 },
                { type: "multiple-choice-reverse", text: "Что значит: ", questionProp: "french", answerProp: "russian", optionsCount: 4 },
                { type: "ordering", text: "Расположите месяцы в правильном порядке:" },
                { type: "drag-match", text: "Сопоставьте французские месяцы с русскими переводами:" },
                { type: "season-association", text: "К какому времени года относится месяц: ", questionProp: "french", answerProp: "season" }
            ],
            seasons: [
                { type: "multiple-choice", text: "Выберите правильный перевод для: ", questionProp: "russian", answerProp: "french", optionsCount: 4 },
                { type: "multiple-choice-reverse", text: "Что значит: ", questionProp: "french", answerProp: "russian", optionsCount: 4 },
                { type: "visual-association", text: "Выберите время года, которое соответствует иконке:" },
                { type: "season-months", text: "Какие месяцы относятся к времени года: ", questionProp: "french", answerProp: "months", optionsCount: 6 }
            ]
        };

        // Состояние игры
        const gameState = {
            currentSection: null,
            currentQuestionIndex: 0,
            questions: [],
            score: 0,
            totalQuestions: 0,
            correctAnswers: 0
        };

        // Инициализация игры
        document.addEventListener('DOMContentLoaded', function() {
            // Обработчики главного меню
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    startGame(section);
                });
            });

            // Обработчики кнопок "Назад"
            document.getElementById('days-back-btn').addEventListener('click', () => showMainMenu());
            document.getElementById('months-back-btn').addEventListener('click', () => showMainMenu());
            document.getElementById('seasons-back-btn').addEventListener('click', () => showMainMenu());

            // Обработчики кнопок "Далее"
            document.getElementById('days-next-btn').addEventListener('click', () => nextQuestion('days'));
            document.getElementById('months-next-btn').addEventListener('click', () => nextQuestion('months'));
            document.getElementById('seasons-next-btn').addEventListener('click', () => nextQuestion('seasons'));

            // Обработчик кнопки "Начать заново"
            document.getElementById('restart-btn').addEventListener('click', () => showMainMenu());
        });

        // Начать игру
        function startGame(section) {
            gameState.currentSection = section;
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.questions = generateQuestions(section);
            gameState.totalQuestions = gameState.questions.length;

            // Показать игровую область
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById(`${section}-game`).classList.add('active');
            
            // Загрузить первый вопрос
            loadQuestion(section, 0);
            
            // Обновить прогресс
            updateProgress(section);
        }

        // Показать главное меню
        function showMainMenu() {
            // Скрыть все игровые области
            document.querySelectorAll('.game-area').forEach(area => {
                area.classList.remove('active');
            });
            
            // Скрыть экран результатов
            document.getElementById('results-screen').classList.remove('active');
            
            // Показать главное меню
            document.getElementById('main-menu').style.display = 'grid';
        }

        // Генерация вопросов
        function generateQuestions(section) {
            const questions = [];
            const types = questionTypes[section];
            
            // Для каждого типа вопроса создаем несколько вопросов
            types.forEach(type => {
                // Определяем количество вопросов каждого типа
                let count = 0;
                switch(type.type) {
                    case 'multiple-choice':
                    case 'multiple-choice-reverse':
                        count = 4;
                        break;
                    case 'ordering':
                        count = 1;
                        break;
                    case 'drag-match':
                        count = 1;
                        break;
                    case 'visual-association':
                        count = 2;
                        break;
                    case 'season-association':
                        count = 3;
                        break;
                    case 'season-months':
                        count = 2;
                        break;
                }
                
                // Создаем вопросы
                for (let i = 0; i < count; i++) {
                    const question = generateQuestion(section, type);
                    if (question) questions.push(question);
                }
            });
            
            // Перемешиваем вопросы
            return shuffleArray(questions);
        }

        // Генерация одного вопроса
        function generateQuestion(section, questionType) {
            const data = gameData[section];
            
            switch(questionType.type) {
                case 'multiple-choice':
                case 'multiple-choice-reverse':
                    return generateMultipleChoiceQuestion(section, questionType);
                case 'ordering':
                    return generateOrderingQuestion(section);
                case 'drag-match':
                    return generateDragMatchQuestion(section);
                case 'visual-association':
                    return generateVisualAssociationQuestion();
                case 'season-association':
                    return generateSeasonAssociationQuestion();
                case 'season-months':
                    return generateSeasonMonthsQuestion();
            }
        }

        // Генерация вопроса с множественным выбором
        function generateMultipleChoiceQuestion(section, questionType) {
            const data = gameData[section];
            const randomItem = data[Math.floor(Math.random() * data.length)];
            
            // Создаем неправильные варианты ответов
            const incorrectOptions = [];
            const allItems = [...data];
            
            // Удаляем правильный ответ из списка всех вариантов
            const correctIndex = allItems.findIndex(item => item[questionType.answerProp] === randomItem[questionType.answerProp]);
            if (correctIndex > -1) allItems.splice(correctIndex, 1);
            
            // Выбираем случайные неправильные ответы
            for (let i = 0; i < questionType.optionsCount - 1; i++) {
                const randomIndex = Math.floor(Math.random() * allItems.length);
                incorrectOptions.push(allItems[randomIndex][questionType.answerProp]);
                allItems.splice(randomIndex, 1);
            }
            
            // Создаем все варианты ответов и перемешиваем
            const allOptions = [randomItem[questionType.answerProp], ...incorrectOptions];
            const shuffledOptions = shuffleArray([...allOptions]);
            
            return {
                type: questionType.type,
                text: questionType.text + randomItem[questionType.questionProp],
                correctAnswer: randomItem[questionType.answerProp],
                options: shuffledOptions,
                pronunciation: randomItem.pronunciation,
                french: randomItem.french
            };
        }

        // Генерация вопроса на упорядочивание
        function generateOrderingQuestion(section) {
            const data = gameData[section];
            // Берем все элементы и перемешиваем
            const shuffledItems = shuffleArray([...data]);
            
            return {
                type: 'ordering',
                text: 'Расположите в правильном порядке:',
                correctOrder: data.map(item => item.french),
                items: shuffledItems.map(item => item.french),
                pronunciation: data.map(item => item.pronunciation)
            };
        }

        // Генерация вопроса на сопоставление (drag & drop)
        function generateDragMatchQuestion(section) {
            const data = gameData[section];
            // Берем 4 случайных элемента
            const randomItems = [];
            const usedIndices = new Set();
            
            while (randomItems.length < 4 && randomItems.length < data.length) {
                const randomIndex = Math.floor(Math.random() * data.length);
                if (!usedIndices.has(randomIndex)) {
                    usedIndices.add(randomIndex);
                    randomItems.push(data[randomIndex]);
                }
            }
            
            // Создаем источники (французские слова) и цели (русские переводы)
            const sources = shuffleArray(randomItems.map(item => item.french));
            const targets = shuffleArray(randomItems.map(item => item.russian));
            
            return {
                type: 'drag-match',
                text: 'Сопоставьте французские слова с русскими переводами:',
                correctMatches: randomItems.reduce((acc, item) => {
                    acc[item.french] = item.russian;
                    return acc;
                }, {}),
                sources: sources,
                targets: targets,
                pronunciation: randomItems.map(item => item.pronunciation)
            };
        }

        // Генерация визуального вопроса
        function generateVisualAssociationQuestion() {
            const seasons = gameData.seasons;
            const randomSeason = seasons[Math.floor(Math.random() * seasons.length)];
            
            // Создаем неправильные варианты
            const incorrectOptions = [];
            const allSeasons = [...seasons];
            
            // Удаляем правильный ответ
            const correctIndex = allSeasons.findIndex(season => season.french === randomSeason.french);
            if (correctIndex > -1) allSeasons.splice(correctIndex, 1);
            
            // Выбираем случайные неправильные ответы
            for (let i = 0; i < 3; i++) {
                const randomIndex = Math.floor(Math.random() * allSeasons.length);
                incorrectOptions.push(allSeasons[randomIndex]);
                allSeasons.splice(randomIndex, 1);
            }
            
            // Создаем все варианты и перемешиваем
            const allOptions = [randomSeason, ...incorrectOptions];
            const shuffledOptions = shuffleArray([...allOptions]);
            
            return {
                type: 'visual-association',
                text: 'Выберите время года, которое соответствует иконке:',
                correctAnswer: randomSeason.french,
                icon: randomSeason.icon,
                options: shuffledOptions.map(season => season.french),
                pronunciation: randomSeason.pronunciation
            };
        }

        // Генерация вопроса на ассоциацию с временем года
        function generateSeasonAssociationQuestion() {
            const months = gameData.months;
            const randomMonth = months[Math.floor(Math.random() * months.length)];
            const season = gameData.seasons.find(s => s.french === randomMonth.season);
            
            // Создаем неправильные варианты
            const incorrectOptions = [];
            const allSeasons = [...gameData.seasons];
            
            // Удаляем правильный ответ
            const correctIndex = allSeasons.findIndex(s => s.french === season.french);
            if (correctIndex > -1) allSeasons.splice(correctIndex, 1);
            
            // Выбираем случайные неправильные ответы
            for (let i = 0; i < 3; i++) {
                const randomIndex = Math.floor(Math.random() * allSeasons.length);
                incorrectOptions.push(allSeasons[randomIndex].french);
                allSeasons.splice(randomIndex, 1);
            }
            
            // Создаем все варианты и перемешиваем
            const allOptions = [season.french, ...incorrectOptions];
            const shuffledOptions = shuffleArray([...allOptions]);
            
            return {
                type: 'season-association',
                text: 'К какому времени года относится месяц: ' + randomMonth.french,
                correctAnswer: season.french,
                options: shuffledOptions,
                pronunciation: randomMonth.pronunciation,
                month: randomMonth.french
            };
        }

        // Генерация вопроса на определение месяцев в сезоне
        function generateSeasonMonthsQuestion() {
            const seasons = gameData.seasons;
            const randomSeason = seasons[Math.floor(Math.random() * seasons.length)];
            
            // Получаем месяцы этого сезона
            const seasonMonths = gameData.months.filter(month => month.season === randomSeason.french);
            
            // Создаем неправильные варианты (месяцы из других сезонов)
            const incorrectMonths = gameData.months.filter(month => month.season !== randomSeason.french);
            
            // Выбираем случайные неправильные ответы
            const selectedIncorrect = [];
            for (let i = 0; i < 3; i++) {
                const randomIndex = Math.floor(Math.random() * incorrectMonths.length);
                selectedIncorrect.push(incorrectMonths[randomIndex].french);
                incorrectMonths.splice(randomIndex, 1);
            }
            
            // Берем 3 правильных месяца (если есть столько)
            const correctMonths = seasonMonths.slice(0, 3).map(month => month.french);
            
            // Создаем все варианты и перемешиваем
            const allOptions = [...correctMonths, ...selectedIncorrect].slice(0, 6);
            const shuffledOptions = shuffleArray([...allOptions]);
            
            // Правильные ответы (множественный выбор)
            const correctAnswers = correctMonths;
            
            return {
                type: 'season-months',
                text: 'Какие месяцы относятся к времени года: ' + randomSeason.french,
                correctAnswers: correctAnswers,
                options: shuffledOptions,
                pronunciation: randomSeason.pronunciation,
                season: randomSeason.french
            };
        }

        // Загрузка вопроса
        function loadQuestion(section, questionIndex) {
            const question = gameState.questions[questionIndex];
            const container = document.getElementById(`${section}-question-container`);
            
            // Очищаем контейнер
            container.innerHTML = '';
            
            // Создаем вопрос в зависимости от типа
            switch(question.type) {
                case 'multiple-choice':
                case 'multiple-choice-reverse':
                case 'season-association':
                    loadMultipleChoiceQuestion(container, question, section);
                    break;
                case 'ordering':
                    loadOrderingQuestion(container, question, section);
                    break;
                case 'drag-match':
                    loadDragMatchQuestion(container, question, section);
                    break;
                case 'visual-association':
                    loadVisualQuestion(container, question, section);
                    break;
                case 'season-months':
                    loadSeasonMonthsQuestion(container, question, section);
                    break;
            }
            
            // Скрываем обратную связь
            const feedback = document.getElementById(`${section}-feedback`);
            feedback.classList.remove('correct', 'incorrect');
            feedback.style.display = 'none';
            
            // Обновляем прогресс
            updateProgress(section);
        }

        // Загрузка вопроса с множественным выбором
        function loadMultipleChoiceQuestion(container, question, section) {
            // Добавляем текст вопроса
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text;
            
            if (question.pronunciation) {
                const pronunciation = document.createElement('div');
                pronunciation.className = 'pronunciation';
                pronunciation.textContent = question.pronunciation;
                questionText.appendChild(pronunciation);
            }
            
            container.appendChild(questionText);
            
            // Добавляем варианты ответов
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            
            question.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                
                // Добавляем произношение для месяцев и дней
                if (section !== 'seasons') {
                    const data = gameData[section];
                    const item = data.find(item => item.french === option || item.russian === option);
                    if (item && item.pronunciation) {
                        const pronunciation = document.createElement('div');
                        pronunciation.className = 'pronunciation';
                        pronunciation.textContent = item.pronunciation;
                        optionElement.appendChild(pronunciation);
                    }
                }
                
                optionElement.addEventListener('click', function() {
                    // Проверяем ответ
                    if (option === question.correctAnswer) {
                        // Правильный ответ
                        optionElement.classList.add('correct');
                        showFeedback(section, 'Правильно! Отличная работа!', 'correct');
                        gameState.score += 10;
                        gameState.correctAnswers++;
                        
                        // Воспроизводим звук (симулируем)
                        playSuccessSound();
                    } else {
                        // Неправильный ответ
                        optionElement.classList.add('incorrect');
                        
                        // Находим правильный ответ
                        const correctOption = optionsContainer.querySelector(`.option:contains("${question.correctAnswer}")`);
                        if (correctOption) {
                            correctOption.classList.add('correct');
                        }
                        
                        // Показываем подсказку
                        let hint = 'Попробуйте ещё раз! Правильный ответ: ' + question.correctAnswer;
                        
                        // Добавляем произношение к подсказке
                        if (question.french) {
                            const data = gameData[section];
                            const item = data.find(item => item.french === question.correctAnswer);
                            if (item && item.pronunciation) {
                                hint += ' ' + item.pronunciation;
                            }
                        }
                        
                        showFeedback(section, hint, 'incorrect');
                        
                        // Воспроизводим звук (симулируем)
                        playErrorSound();
                    }
                    
                    // Отключаем все варианты
                    optionsContainer.querySelectorAll('.option').forEach(opt => {
                        opt.style.pointerEvents = 'none';
                    });
                    
                    // Активируем кнопку "Далее"
                    activateNextButton(section);
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            container.appendChild(optionsContainer);
        }

        // Загрузка вопроса на упорядочивание
        function loadOrderingQuestion(container, question, section) {
            // Добавляем текст вопроса
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text;
            container.appendChild(questionText);
            
            // Создаем контейнер для элементов
            const orderingContainer = document.createElement('div');
            orderingContainer.className = 'ordering-container';
            orderingContainer.id = `${section}-ordering-container`;
            
            // Добавляем элементы в перемешанном порядке
            question.items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'ordering-item';
                itemElement.textContent = item;
                itemElement.setAttribute('data-value', item);
                itemElement.setAttribute('draggable', 'true');
                
                const icon = document.createElement('i');
                icon.className = 'fas fa-grip-vertical';
                itemElement.appendChild(icon);
                
                orderingContainer.appendChild(itemElement);
            });
            
            container.appendChild(orderingContainer);
            
            // Добавляем кнопку проверки
            const checkButton = document.createElement('button');
            checkButton.className = 'btn btn-success';
            checkButton.innerHTML = '<i class="fas fa-check"></i> Проверить порядок';
            checkButton.style.margin = '0 auto';
            checkButton.style.display = 'block';
            
            checkButton.addEventListener('click', function() {
                // Получаем текущий порядок
                const items = orderingContainer.querySelectorAll('.ordering-item');
                const currentOrder = Array.from(items).map(item => item.getAttribute('data-value'));
                
                // Проверяем правильность
                const isCorrect = JSON.stringify(currentOrder) === JSON.stringify(question.correctOrder);
                
                if (isCorrect) {
                    showFeedback(section, 'Правильно! Вы отлично знаете порядок!', 'correct');
                    gameState.score += 20;
                    gameState.correctAnswers++;
                    playSuccessSound();
                } else {
                    showFeedback(section, 'Попробуйте ещё раз! Правильный порядок: ' + question.correctOrder.join(', '), 'incorrect');
                    playErrorSound();
                }
                
                // Активируем кнопку "Далее"
                activateNextButton(section);
                checkButton.disabled = true;
            });
            
            container.appendChild(checkButton);
            
            // Добавляем функционал перетаскивания
            makeSortable(orderingContainer);
        }

        // Загрузка вопроса на сопоставление
        function loadDragMatchQuestion(container, question, section) {
            // Добавляем текст вопроса
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text;
            container.appendChild(questionText);
            
            // Создаем контейнер для drag & drop
            const dragContainer = document.createElement('div');
            dragContainer.className = 'drag-container';
            
            // Добавляем источники (слова на французском)
            const sourcesContainer = document.createElement('div');
            sourcesContainer.className = 'drag-match';
            
            question.sources.forEach(source => {
                const sourceElement = document.createElement('div');
                sourceElement.className = 'drag-source';
                sourceElement.textContent = source;
                sourceElement.setAttribute('draggable', 'true');
                sourceElement.setAttribute('data-value', source);
                sourcesContainer.appendChild(sourceElement);
            });
            
            // Добавляем цели (переводы на русском)
            const targetsContainer = document.createElement('div');
            targetsContainer.className = 'drag-match';
            
            question.targets.forEach(target => {
                const targetElement = document.createElement('div');
                targetElement.className = 'drag-target';
                targetElement.textContent = target;
                targetElement.setAttribute('data-value', target);
                targetsContainer.appendChild(targetElement);
            });
            
            dragContainer.appendChild(sourcesContainer);
            dragContainer.appendChild(targetsContainer);
            container.appendChild(dragContainer);
            
            // Добавляем кнопку проверки
            const checkButton = document.createElement('button');
            checkButton.className = 'btn btn-success';
            checkButton.innerHTML = '<i class="fas fa-check"></i> Проверить сопоставление';
            checkButton.style.margin = '0 auto';
            checkButton.style.display = 'block';
            
            checkButton.addEventListener('click', function() {
                // Проверяем сопоставления
                let correctMatches = 0;
                const totalMatches = Object.keys(question.correctMatches).length;
                
                // Здесь в реальной игре нужно было бы проверить,
                // какие элементы перетащены в какие цели
                // Для демонстрации делаем случайный результат
                correctMatches = Math.floor(Math.random() * (totalMatches + 1));
                
                if (correctMatches === totalMatches) {
                    showFeedback(section, 'Отлично! Все сопоставления верны!', 'correct');
                    gameState.score += 20;
                    gameState.correctAnswers++;
                    playSuccessSound();
                } else {
                    showFeedback(section, `Правильно сопоставлено ${correctMatches} из ${totalMatches}. Попробуйте ещё раз!`, 'incorrect');
                    playErrorSound();
                }
                
                // Активируем кнопку "Далее"
                activateNextButton(section);
                checkButton.disabled = true;
            });
            
            container.appendChild(checkButton);
            
            // Добавляем функционал перетаскивания
            setupDragAndDrop();
        }

        // Загрузка визуального вопроса
        function loadVisualQuestion(container, question, section) {
            // Добавляем текст вопроса
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text;
            container.appendChild(questionText);
            
            // Добавляем иконку
            const iconContainer = document.createElement('div');
            iconContainer.style.textAlign = 'center';
            iconContainer.style.margin = '30px 0';
            
            const icon = document.createElement('i');
            icon.className = question.icon;
            icon.style.fontSize = '5rem';
            icon.style.color = '#6C63FF';
            
            iconContainer.appendChild(icon);
            container.appendChild(iconContainer);
            
            // Добавляем варианты ответов
            const visualContainer = document.createElement('div');
            visualContainer.className = 'visual-container';
            
            question.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'visual-option';
                
                // Находим данные для этого времени года
                const season = gameData.seasons.find(s => s.french === option);
                
                // Добавляем иконку для варианта
                const optionIcon = document.createElement('i');
                optionIcon.className = season.icon;
                optionElement.appendChild(optionIcon);
                
                // Добавляем название
                const optionText = document.createElement('div');
                optionText.textContent = option;
                optionElement.appendChild(optionText);
                
                // Добавляем произношение
                const pronunciation = document.createElement('div');
                pronunciation.className = 'pronunciation';
                pronunciation.textContent = season.pronunciation;
                optionElement.appendChild(pronunciation);
                
                optionElement.addEventListener('click', function() {
                    // Проверяем ответ
                    if (option === question.correctAnswer) {
                        // Правильный ответ
                        optionElement.style.borderColor = '#4CAF50';
                        optionElement.style.backgroundColor = '#d4edda';
                        showFeedback(section, 'Правильно! Отличный выбор!', 'correct');
                        gameState.score += 10;
                        gameState.correctAnswers++;
                        playSuccessSound();
                    } else {
                        // Неправильный ответ
                        optionElement.style.borderColor = '#dc3545';
                        optionElement.style.backgroundColor = '#f8d7da';
                        
                        // Находим правильный ответ
                        const correctOption = visualContainer.querySelector(`.visual-option:contains("${question.correctAnswer}")`);
                        if (correctOption) {
                            correctOption.style.borderColor = '#4CAF50';
                            correctOption.style.backgroundColor = '#d4edda';
                        }
                        
                        showFeedback(section, 'Попробуйте ещё раз! Правильный ответ: ' + question.correctAnswer + ' ' + question.pronunciation, 'incorrect');
                        playErrorSound();
                    }
                    
                    // Отключаем все варианты
                    visualContainer.querySelectorAll('.visual-option').forEach(opt => {
                        opt.style.pointerEvents = 'none';
                    });
                    
                    // Активируем кнопку "Далее"
                    activateNextButton(section);
                });
                
                visualContainer.appendChild(optionElement);
            });
            
            container.appendChild(visualContainer);
        }

        // Загрузка вопроса на определение месяцев в сезоне
        function loadSeasonMonthsQuestion(container, question, section) {
            // Добавляем текст вопроса
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = question.text;
            
            // Добавляем произношение
            const pronunciation = document.createElement('div');
            pronunciation.className = 'pronunciation';
            pronunciation.textContent = question.pronunciation;
            questionText.appendChild(pronunciation);
            
            container.appendChild(questionText);
            
            // Инструкция
            const instruction = document.createElement('div');
            instruction.className = 'question-text';
            instruction.style.fontSize = '1.2rem';
            instruction.textContent = 'Выберите все подходящие месяцы (можно несколько):';
            container.appendChild(instruction);
            
            // Добавляем варианты ответов
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            
            // Отслеживаем выбранные ответы
            const selectedAnswers = new Set();
            
            question.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                
                // Добавляем произношение
                const monthData = gameData.months.find(m => m.french === option);
                if (monthData && monthData.pronunciation) {
                    const pronunciation = document.createElement('div');
                    pronunciation.className = 'pronunciation';
                    pronunciation.textContent = monthData.pronunciation;
                    optionElement.appendChild(pronunciation);
                }
                
                optionElement.addEventListener('click', function() {
                    if (selectedAnswers.has(option)) {
                        // Убираем выбор
                        selectedAnswers.delete(option);
                        optionElement.style.backgroundColor = '';
                        optionElement.style.borderColor = '';
                    } else {
                        // Добавляем выбор
                        selectedAnswers.add(option);
                        optionElement.style.backgroundColor = '#e3f2fd';
                        optionElement.style.borderColor = '#2196F3';
                    }
                });
                
                optionsContainer.appendChild(optionElement);
            });
            
            container.appendChild(optionsContainer);
            
            // Добавляем кнопку проверки
            const checkButton = document.createElement('button');
            checkButton.className = 'btn btn-success';
            checkButton.innerHTML = '<i class="fas fa-check"></i> Проверить ответ';
            checkButton.style.margin = '20px auto';
            checkButton.style.display = 'block';
            
            checkButton.addEventListener('click', function() {
                // Проверяем ответ
                const selectedArray = Array.from(selectedAnswers);
                const isCorrect = JSON.stringify(selectedArray.sort()) === JSON.stringify(question.correctAnswers.sort());
                
                if (isCorrect) {
                    showFeedback(section, 'Правильно! Вы отлично знаете месяцы этого времени года!', 'correct');
                    gameState.score += 20;
                    gameState.correctAnswers++;
                    playSuccessSound();
                } else {
                    showFeedback(section, 'Попробуйте ещё раз! Правильные ответы: ' + question.correctAnswers.join(', '), 'incorrect');
                    playErrorSound();
                }
                
                // Активируем кнопку "Далее"
                activateNextButton(section);
                checkButton.disabled = true;
                
                // Отключаем все варианты
                optionsContainer.querySelectorAll('.option').forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });
            });
            
            container.appendChild(checkButton);
        }

        // Показать обратную связь
        function showFeedback(section, message, type) {
            const feedback = document.getElementById(`${section}-feedback`);
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
            feedback.style.display = 'block';
        }

        // Активировать кнопку "Далее"
        function activateNextButton(section) {
            const nextButton = document.getElementById(`${section}-next-btn`);
            nextButton.disabled = false;
            nextButton.style.opacity = '1';
        }

        // Следующий вопрос
        function nextQuestion(section) {
            gameState.currentQuestionIndex++;
            
            if (gameState.currentQuestionIndex < gameState.questions.length) {
                loadQuestion(section, gameState.currentQuestionIndex);
                
                // Деактивируем кнопку "Далее"
                const nextButton = document.getElementById(`${section}-next-btn`);
                nextButton.disabled = true;
                nextButton.style.opacity = '0.7';
            } else {
                // Игра завершена
                showResults(section);
            }
            
            updateProgress(section);
        }

        // Показать результаты
        function showResults(section) {
            // Скрываем игровую область
            document.getElementById(`${section}-game`).classList.remove('active');
            
            // Показываем экран результатов
            const resultsScreen = document.getElementById('results-screen');
            resultsScreen.classList.add('active');
            
            // Рассчитываем процент правильных ответов
            const percent = Math.round((gameState.correctAnswers / gameState.totalQuestions) * 100);
            
            // Обновляем результаты
            document.getElementById('final-score').textContent = percent + '%';
            document.getElementById('correct-answers').textContent = gameState.correctAnswers;
            document.getElementById('total-questions').textContent = gameState.totalQuestions;
            document.getElementById('success-percent').textContent = percent + '%';
            
            // Устанавливаем звёзды
            let stars = '★★★★★';
            if (percent < 20) stars = '★☆☆☆☆';
            else if (percent < 40) stars = '★★☆☆☆';
            else if (percent < 60) stars = '★★★☆☆';
            else if (percent < 80) stars = '★★★★☆';
            
            document.getElementById('stars').textContent = stars;
            
            // Устанавливаем поощрительное сообщение
            let encouragement = '';
            if (percent < 40) {
                encouragement = 'Продолжайте практиковаться! Вы на правильном пути!';
            } else if (percent < 70) {
                encouragement = 'Хорошая работа! Вы хорошо усвоили материал!';
            } else if (percent < 90) {
                encouragement = 'Отличный результат! Вы почти всё знаете!';
            } else {
                encouragement = 'Превосходно! Вы отлично знаете эту тему!';
            }
            
            document.getElementById('encouragement').textContent = encouragement;
        }

        // Обновить прогресс
        function updateProgress(section) {
            const progress = document.getElementById(`${section}-progress`);
            const progressText = document.getElementById(`${section}-progress-text`);
            
            const percent = ((gameState.currentQuestionIndex + 1) / gameState.questions.length) * 100;
            progress.style.width = percent + '%';
            progressText.textContent = `Вопрос ${gameState.currentQuestionIndex + 1} из ${gameState.questions.length}`;
        }

        // Воспроизвести звук успеха
        function playSuccessSound() {
            // В реальном приложении здесь был бы звуковой файл
            // Для демонстрации просто создаем аудио элемент
            try {
                const audio = new Audio();
                // Генерируем простой звук успеха с помощью Web Audio API
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Если Web Audio API не поддерживается, просто продолжаем без звука
            }
        }

        // Воспроизвести звук ошибки
        function playErrorSound() {
            // Аналогично звуку успеха, но с другой частотой
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 300;
                oscillator.type = 'sawtooth';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                // Если Web Audio API не поддерживается, просто продолжаем без звука
            }
        }

        // Сделать элементы сортируемыми
        function makeSortable(container) {
            let draggedItem = null;
            
            container.querySelectorAll('.ordering-item').forEach(item => {
                item.addEventListener('dragstart', function() {
                    draggedItem = this;
                    setTimeout(() => this.style.opacity = '0.4', 0);
                });
                
                item.addEventListener('dragend', function() {
                    setTimeout(() => {
                        draggedItem.style.opacity = '1';
                        draggedItem = null;
                    }, 0);
                });
                
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.style.borderTop = '2px solid #6C63FF';
                });
                
                item.addEventListener('dragleave', function() {
                    this.style.borderTop = '';
                });
                
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.style.borderTop = '';
                    
                    if (draggedItem !== this) {
                        const allItems = container.querySelectorAll('.ordering-item');
                        const thisIndex = Array.from(allItems).indexOf(this);
                        const draggedIndex = Array.from(allItems).indexOf(draggedItem);
                        
                        if (draggedIndex < thisIndex) {
                            this.parentNode.insertBefore(draggedItem, this.nextSibling);
                        } else {
                            this.parentNode.insertBefore(draggedItem, this);
                        }
                    }
                });
            });
        }

        // Настроить drag & drop
        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.drag-source');
            const targets = document.querySelectorAll('.drag-target');
            
            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });
                
                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });
            
            targets.forEach(target => {
                target.addEventListener('dragover', e => {
                    e.preventDefault();
                    target.classList.add('over');
                });
                
                target.addEventListener('dragleave', () => {
                    target.classList.remove('over');
                });
                
                target.addEventListener('drop', () => {
                    target.classList.remove('over');
                });
            });
        }

        // Вспомогательные функции
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Добавляем метод contains для поиска по тексту (для совместимости)
        if (!Element.prototype.matches) {
            Element.prototype.matches = Element.prototype.msMatchesSelector || 
                                        Element.prototype.webkitMatchesSelector;
        }

        if (!Element.prototype.closest) {
            Element.prototype.closest = function(s) {
                let el = this;
                do {
                    if (el.matches(s)) return el;
                    el = el.parentElement || el.parentNode;
                } while (el !== null && el.nodeType === 1);
                return null;
            };
        }
    </script>
</body>
</html>
